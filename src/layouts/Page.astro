---
import '@fontsource/space-mono/400.css'
import '@fontsource/space-mono/700.css'
import { ViewTransitions } from 'astro:transitions'

interface Props {
  title?: string
  constrainWidth?: boolean
}
const props = Astro.props
const constrainContent = props.constrainWidth ?? true

import Header from '../components/Header.astro'

import BaseHead from '../components/BaseHead.astro'
import { siteTitle, siteDescription } from '../consts'
---

<!doctype html>
<html lang="en" style="scroll-behavior: smooth;">
  <head>
    <BaseHead title={siteTitle} description={siteDescription} />
    <script is:inline>
      // Immediately apply theme before page renders to prevent flash
      ;(function () {
        function applyThemeClasses() {
          const getSystemTheme = () =>
            window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
          const storedMode = localStorage.getItem('themeMode') || 'system'

          document.documentElement.classList.remove('dark', 'light', 'system')

          if (storedMode === 'system') {
            document.documentElement.classList.add('system', getSystemTheme())
          } else {
            document.documentElement.classList.add(storedMode)
          }
        }

        // Apply immediately
        applyThemeClasses()

        // Re-apply after view transitions swap HTML
        document.addEventListener('astro:after-swap', applyThemeClasses)
      })()
    </script>
    <ViewTransitions />
    <title>Kuhrt{props.title ? `â€“ ${props.title}` : ''}</title>
  </head>
  <body class="flex items-center flex-col mb-[50vh]">
    <Header />
    <div
      class="pt-20"
      class:list={{ 'max-w-3xl px-10 w-full': constrainContent }}
      transition:name="main-content"
      transition:animate="slide"
    >
      <slot />
    </div>
  </body>
</html>
